<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://aem.design/feed.xml" rel="self" type="application/atom+xml" /><link href="https://aem.design/" rel="alternate" type="text/html" /><updated>2022-04-07T12:47:50+10:00</updated><id>https://aem.design/feed.xml</id><title type="html">AEM.Design</title><subtitle>An amazing website.</subtitle><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;nil, &quot;bio&quot;=&gt;nil, &quot;location&quot;=&gt;nil, &quot;email&quot;=&gt;nil, &quot;links&quot;=&gt;[{&quot;label&quot;=&gt;&quot;Email&quot;, &quot;icon&quot;=&gt;&quot;fas fa-fw fa-envelope-square&quot;}, {&quot;label&quot;=&gt;&quot;Website&quot;, &quot;icon&quot;=&gt;&quot;fas fa-fw fa-link&quot;}, {&quot;label&quot;=&gt;&quot;Twitter&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-twitter-square&quot;}, {&quot;label&quot;=&gt;&quot;Facebook&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-facebook-square&quot;}, {&quot;label&quot;=&gt;&quot;GitHub&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-github&quot;}, {&quot;label&quot;=&gt;&quot;Instagram&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-instagram&quot;}]}</name></author><entry><title type="html">Docker Compose and Deploy Stacks üçîüòò</title><link href="https://aem.design/blog/2022/02/08/docker-compose-and-deploy-stacks%F0%9F%8D%94%F0%9F%98%98" rel="alternate" type="text/html" title="Docker Compose and Deploy Stacks üçîüòò" /><published>2022-02-08T00:37:00+11:00</published><updated>2022-02-08T08:14:14+11:00</updated><id>https://aem.design/blog/2022/02/08/docker-compose</id><content type="html" xml:base="https://aem.design/blog/2022/02/08/docker-compose-and-deploy-stacks%F0%9F%8D%94%F0%9F%98%98"><![CDATA[<p>Following up on the articles <a href="/blog/2019/09/04/aem-and-docker">AEM and Docker</a>, <a href="/blog/2019/07/01/docker-containers-everywhere">Docker Containers Everywhere</a> and <a href="/blog/2019/08/30/docker-aem-bundle">Docker AEM Bundle</a>, lets pull all that knowledge together and talk about how to deploy AEM stacks to developers using Docker Compose. There are many ways to bring a stack to developers machines, but the simplest way is to use Docker Compose.</p>

<p>Additionally, when using Docker Compose, you will understand whether your deployment architecture is complex and which parts are critical; this will provide you with some feedback to clean things up.</p>

<h2 id="docker-compose-experience">Docker Compose Experience</h2>

<p>Docker Compose requires you to have one <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file in your project root. This file is a YAML file that describes the deployment of your stack. In simple scenarios, you can just have one file, and it will be enough; for most scenarios having a structure set up for growth is going to be beneficial long term. When a developer clones your repo all they need to do is to run <code class="language-plaintext highlighter-rouge">docker compose up</code>, and the stack will be deployed. Once it‚Äôs running, they open their browser and go to <code class="language-plaintext highlighter-rouge">http://localhost</code>, and they will land on stack console:</p>

<p><img src="/assets/images/docker/traefik-stack-console.png" alt="Traefik Stack Console" /></p>

<p>This simple console can be updated in any way required to convey context and provide any relevant information and links to developers working on the project. This is a straightforward way to surface a lot of documentation in a usable manner.</p>

<h2 id="docker-compose-stack-details">Docker Compose Stack Details</h2>

<p>Let‚Äôs take a deeper look at the details; here is an example of a simple deployment you can see the source here <a href="https://github.com/aem-design/aemdesign-aem-support/blob/master/docker-compose.yml">docker-compose.yml</a>. This docker compose file has the following services:</p>

<ul>
  <li>nginx - developer console, provides a developer-friendly console to visualise all of their services and provide shortcuts to all relevant consoles.</li>
  <li>createcert - a service that creates a self-signed certificate for the AEM instance.</li>
  <li>createcertpkcs12 - a service that creates a self-signed certificate that can be installed into the browser.</li>
  <li>traefik - a service that provides a reverse proxy to the AEM instance.</li>
  <li>seleniumhub - a service that provides a hub for selenium.</li>
  <li>selenium-node-chrome - a service that provides a selenium node for chrome.</li>
  <li>author - a primary author service.</li>
  <li>author-deploy-core - a service that deploys the AEM core to author instance.</li>
  <li>author-deploy-support - a service that deploys the AEM support to author instance.</li>
  <li>publish - a publish instance service.</li>
  <li>publish-deploy-core - a service that deploys the AEM core to publish instance.</li>
  <li>publish-deploy-support - a service that deploys the AEM support to publish instance.</li>
  <li>dispatcher - a dispatcher service.</li>
  <li>testing - this is meant to run when there is a aemdesign-parent repo, so when you are developing locally.</li>
  <li>automationtest - this meant to run in aemdesign-aem-support repo pipeline.</li>
  <li>automationtestprep - this meant to run in aemdesign-aem-support repo pipeline, will download the latest core and install local support packages.</li>
  <li>testingcheck - a service that check if test automation is working.</li>
</ul>

<p>These services can be activated all at once or individually, you can run <code class="language-plaintext highlighter-rouge">docker compose up traekfik nginx</code> to get only the developer console on <code class="language-plaintext highlighter-rouge">http://localhost</code>. Some of the services have dependencies on others, so you can see the order in which they are activated. Some services are optional and can be activated when required using profile activation <code class="language-plaintext highlighter-rouge">docker compose up -p dodeploy author-deploy-core</code>.</p>

<p>This example I‚Äôve provided uses the older <code class="language-plaintext highlighter-rouge">2.4</code> version of docker compose that supports the <code class="language-plaintext highlighter-rouge">EXTENDS</code> keyword:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">extends</span><span class="pi">:</span>
  <span class="na">file</span><span class="pi">:</span> <span class="s">./docker/aem/docker-compose.yml</span>
  <span class="na">service</span><span class="pi">:</span> <span class="s">author-deploy-support</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">EXTENDS</code> keyword allows you to pull together predefined docker compose files from a better-organised structure.</p>

<p>Having a well-organised docker folder with a subfolder for all services will ensure that you can have a single file that can be used to deploy all of your services. This also allows you to have all of the relevant per service configurations isolated and not mixed in the same file. Here is an example structure of a docker folder, <a href="https://github.com/aem-design/aemdesign-aem-support/tree/master/docker">source is here</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker
‚îú‚îÄ‚îÄ aem
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ common
‚îÇ   ‚îú‚îÄ‚îÄ config-tz.yml
‚îú‚îÄ‚îÄ nginx
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ selenium
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ testing
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ traefik
    ‚îî‚îÄ‚îÄ docker-compose.yml
</code></pre></div></div>

<p>If you check out the <a href="https://github.com/aem-design/aemdesign-aem-support/tree/master/docker">github link</a> you will find a number of relevant config files in each service folder. Furthermore, as you add new services, it will be easy to follow this pattern to keep things neat and tidy.</p>

<p>In later versions of docker compose, see <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/">compose-file-v3</a>, you can‚Äôt use <code class="language-plaintext highlighter-rouge">EXTENDS</code> keyword and you need to pass all of the required service <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> files when running <code class="language-plaintext highlighter-rouge">docker compose up</code> command. This can be simply abstracted into a start script here is an example of how to do it <a href="https://github.com/wildone/synology-docker/blob/main/start.ps1">start.ps1</a>. This is a PowerShell script that will run <code class="language-plaintext highlighter-rouge">docker compose up</code> command for all services activated from <code class="language-plaintext highlighter-rouge">start-services.conf</code> file. In addition, that script leverages <code class="language-plaintext highlighter-rouge">.env</code> file to keep all of your environment variables in one place for easy maintenance, see example <a href="https://github.com/wildone/synology-docker/blob/main/.env">.env</a> file. You can read more about <a href="https://github.com/wildone/synology-docker/blob/main/.env">environment files</a> on official docs.</p>

<h3 id="thank-you">Thank you</h3>

<p>I hope you will find using docker compose will being a smile to your face {insert home alone 2 smile}. As always if you have any questions or comments, feel free to contact me. I will be happy to help.</p>

<p>Let me know what you think and don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="docker" /><category term="automation" /><category term="docker-compose" /><summary type="html"><![CDATA[How to use docker compose like a pro!]]></summary></entry><entry><title type="html">Goodbye Centos</title><link href="https://aem.design/blog/2022/02/06/goodbye-centos" rel="alternate" type="text/html" title="Goodbye Centos" /><published>2022-02-06T00:00:00+11:00</published><updated>2022-02-07T00:37:32+11:00</updated><id>https://aem.design/blog/2022/02/06/goodbye-centos</id><content type="html" xml:base="https://aem.design/blog/2022/02/06/goodbye-centos"><![CDATA[<p>Centos is no more! You already know that. The founder of Kurtzer, who started Centos more than 16 years ago, was shocked just as much. Centos was a great gap filler between Fedora and RHEL. You had the best of both worlds, but you could use it for development and then roll your apps straight to RHEL if you need enterprise support.</p>

<p>What does this mean for AEM? Well, it means all of the containers essentially will need to be updated to use something else. You can‚Äôt use Centos, so the next best thing would be ‚Ä¶ Debian. Yes, Ubuntu is a good contender, but you won‚Äôt be able to run AEM Forms on it; tldr, Ubuntu does not have 32bit support.</p>

<p>Old containers will keep working, but slowly, all new updates would need to be rolled on the new Debian images that are available right now. Go ahead check them to see what you think. You can also check out the <a href="https://hub.docker.com/u/aemdesign/">AEM.Design Docker Hub</a> for the latest images.</p>

<p>Here, for example, the latest AEM 6.5 with SP 11:</p>

<div class="code-copy-header">
  <button class="copy-code-button" aria-label="Copy code to clipboard"></button>
</div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">author6511</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"TZ=Australia/Sydney"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_RUNMODE=-Dsling.run.modes=author,crx3,crx3tar,forms,localdev"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_JVM_OPTS=-server -Xms248m -Xmx1524m -XX:MaxDirectMemorySize=256M -XX:+CMSClassUnloadingEnabled -Djava.awt.headless=true -Dorg.apache.felix.http.host=0.0.0.0 -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=58242,suspend=n -XX:+UseParallelGC --add-opens=java.desktop/com.sun.imageio.plugins.jpeg=ALL-UNNAMED --add-opens=java.base/sun.net.www.protocol.jrt=ALL-UNNAMED --add-opens=java.naming/javax.naming.spi=ALL-UNNAMED --add-opens=java.xml/com.sun.org.apache.xerces.internal.dom=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/jdk.internal.loader=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED -Dnashorn.args=--no-deprecation-warning"</span><span class="w"> </span><span class="nt">-p4502</span><span class="p">:</span><span class="nx">8080</span><span class="w"> </span><span class="nt">-p30303</span><span class="p">:</span><span class="nx">58242</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">aemdesign/aem:6.5.11.0-jdk11</span><span class="w">
</span></code></pre></div></div>

<p>And as an extra bonus, if you prefer to use this on your M1 Mac, here is the same command again with the ARM suffix in the tag:</p>

<div class="code-copy-header">
  <button class="copy-code-button" aria-label="Copy code to clipboard"></button>
</div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">author6511</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"TZ=Australia/Sydney"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_RUNMODE=-Dsling.run.modes=author,crx3,crx3tar,forms,localdev"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_JVM_OPTS=-server -Xms248m -Xmx1524m -XX:MaxDirectMemorySize=256M -XX:+CMSClassUnloadingEnabled -Djava.awt.headless=true -Dorg.apache.felix.http.host=0.0.0.0 -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=58242,suspend=n -XX:+UseParallelGC --add-opens=java.desktop/com.sun.imageio.plugins.jpeg=ALL-UNNAMED --add-opens=java.base/sun.net.www.protocol.jrt=ALL-UNNAMED --add-opens=java.naming/javax.naming.spi=ALL-UNNAMED --add-opens=java.xml/com.sun.org.apache.xerces.internal.dom=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/jdk.internal.loader=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED -Dnashorn.args=--no-deprecation-warning"</span><span class="w"> </span><span class="nt">-p4502</span><span class="p">:</span><span class="nx">8080</span><span class="w"> </span><span class="nt">-p30303</span><span class="p">:</span><span class="nx">58242</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">aemdesign/aem:6.5.11.0-jdk11-arm</span><span class="w">
</span></code></pre></div></div>

<h3 id="thank-you">Thank you</h3>

<p>I hope you will find the new ARM images useful. If you have any questions or comments, feel free to contact me. I will be happy to help.</p>

<p>Let me know what you think and don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="centos" /><summary type="html"><![CDATA[You were great while the free ride lasted!]]></summary></entry><entry><title type="html">Goodbye Docker Desktop</title><link href="https://aem.design/blog/2022/02/01/goodbye-docker-desktop" rel="alternate" type="text/html" title="Goodbye Docker Desktop" /><published>2022-02-01T00:00:00+11:00</published><updated>2022-04-07T12:44:05+10:00</updated><id>https://aem.design/blog/2022/02/01/goodbye-docker-desktop</id><content type="html" xml:base="https://aem.design/blog/2022/02/01/goodbye-docker-desktop"><![CDATA[<p>First of all, if it wasn‚Äôt for docker, the technology landscape would be very different today. Thank you, docker and the team behind it! I do feel that some technologies that come out as open-source and force other vendors to show their cards. Docker single-handled changed the way a lot of things are done in software development; this is probably an understatement, as it is amazing! I feel that the docker team is doing a great job and I hope this will continue.</p>

<p>But as you all know, docker desktop WAS a great tool for running docker on your desktop, up until it became a thing of the past. It drove itself off the cliff with paid subscription. Most corporate companies will think long and hard before purchasing docker desktop licences. So if you can‚Äôt use it at work, why would you use it at home? After all, you are what you practice, and you are what you use. Consistency of tools is critical to developers.</p>

<p>There are many alternatives to the docker desktop stack, but let‚Äôs not throw docker simplicity out the window yet. Obviously, Kube and Helm is the destination, but let‚Äôs take small steps. For DevOps, using git with docker-compose gives you all the power of git and docker. Yes team behind Docker Desktop have added a lot of front end features to it, and maybe there is a use case for them, but in a pipeline driven world, you can‚Äôt use them. You don‚Äôt use docker desktop in production so keeping rest of the stack the same would be a good idea.</p>

<p>So this brings this journey to a crossroads. Do you build a VM and run the docker engine and docker-compose in there, or do you run this semi-natively? If you are on Linux/Unix you are alright; you can google your way out. On windows, however best experience would be attained through Powershell Core7, WSL2 and Windows Terminal. Go ahead try these on; you will never look back! Also, while you are at it, stop using CYGWIN to do this; you are making your life harder than you have to. :P</p>

<p>Now that you have tools from the future installed, lets proceed to the next steps</p>

<h2 id="wsl-install-ubuntu">WSL Install Ubuntu</h2>

<p>This is a ubuntu guide, same as Docker Desktop, Centos ecosystem is dead, so using Ubuntu is the best option we have. (long story post to follow).</p>

<h3 id="wsl-download-and-import-ubuntu">Wsl download and Import ubuntu</h3>

<p>Open up Powershell core and run the followig commands.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mkdir</span><span class="w"> </span><span class="nx">c:/wsl</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">c:/wsl</span><span class="w">
</span><span class="n">curl.exe</span><span class="w"> </span><span class="nt">-L</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">impish-server-cloudimg-amd64-root.tar.xz</span><span class="w"> </span><span class="nx">https://cloud-images.ubuntu.com/impish/current/impish-server-cloudimg-amd64-root.tar.xz</span><span class="w">
</span><span class="n">wsl</span><span class="w"> </span><span class="nt">--import</span><span class="w"> </span><span class="nx">ubuntu</span><span class="w"> </span><span class="nx">c:/wsl/ubuntu2110</span><span class="w"> </span><span class="nx">c:/projects/wsl/impish-server-cloudimg-amd64-wsl.rootfs.tar.gz</span><span class="w">
</span></code></pre></div></div>

<p>Now you have a ubuntu image in your WSL, you can restart Windows Terminal, and it will appear as a new option.</p>

<h3 id="config-ubuntu">Config Ubuntu</h3>

<p>Because we did not use MS apx, the new Ubuntu has only a root user; best approach is to add a new user to your liking. Run the new ubuntu terminal in Windows Terminal, and in it run the following commands. (Change user name and password as you like when prompted.)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adduser <span class="nt">-d</span> /home/maxbarrass <span class="nt">-m</span> maxbarrass
passwd maxbarrass
addgroup maxbarrass <span class="nb">sudo
</span>usermod <span class="nt">-aG</span> <span class="nb">sudo </span>maxbarrass
</code></pre></div></div>

<h3 id="update-windows-terminal-profile">Update Windows Terminal Profile</h3>

<p>Now that you have a new user in your Ubuntu, you can update your Windows Terminal profile to use the new user.</p>

<p>This should be in the Command line for your ubuntu profile:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wsl.exe -d ubuntu -u maxbarrass
</code></pre></div></div>

<h3 id="install-docker-in-ubuntu">Install docker in Ubuntu</h3>

<p>Create a new script <code class="language-plaintext highlighter-rouge">nano instal-docker.sh</code> with the following content and run it. This will install docker and docker-compose, as well as add docker service start to your <code class="language-plaintext highlighter-rouge">.profile</code>. This way, when you open your Ubuntu, it will ensure that docker is running.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># update the package manager and install some prerequisites (all of these aren't technically required)</span>
<span class="nb">sudo </span>apt-get update <span class="nt">-y</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> apt-transport-https ca-certificates curl software-properties-common libssl-dev libffi-dev git wget nano

<span class="c"># create a group named docker and add yourself to it</span>
<span class="c">#   so that we don't have to type sudo docker every time</span>
<span class="c">#   note you will need to logout and login before this takes affect (which we do later)</span>
<span class="nb">sudo </span>groupadd docker
<span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>

<span class="c"># add Docker key and repo</span>
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -
<span class="nb">sudo </span>add-apt-repository <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span> <span class="nt">-y</span>

<span class="c"># (optional) add kubectl key and repo</span>
curl <span class="nt">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg | <span class="nb">sudo </span>apt-key add -
<span class="nb">echo</span> <span class="s2">"deb https://apt.kubernetes.io/ kubernetes-xenial main"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/kubernetes.list

<span class="c"># update the package manager with the new repos</span>
<span class="nb">sudo </span>apt-get update

<span class="c"># upgrade the distro</span>
<span class="nb">sudo </span>apt-get upgrade <span class="nt">-y</span>
<span class="nb">sudo </span>apt-get autoremove <span class="nt">-y</span>

<span class="c"># install docker</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> docker-ce containerd.io

<span class="c"># (optional) install kubectl</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> kubectl

<span class="c"># (optional) install latest version of docker compose</span>
<span class="nb">sudo </span>curl <span class="nt">-sSL</span> https://github.com/docker/compose/releases/download/v<span class="sb">`</span>curl <span class="nt">-s</span> https://github.com/docker/compose/tags | <span class="nb">grep</span> <span class="s2">"compose/releases/tag"</span> | <span class="nb">sed</span> <span class="nt">-r</span> <span class="s1">'s|.*([0-9]+\.[0-9]+\.[0-9]+).*|\1|p'</span> | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="sb">`</span>/docker-compose-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-s</span> | <span class="nb">tr</span> <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="sb">`</span>-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-m</span><span class="sb">`</span> <span class="nt">-o</span> /usr/local/bin/docker-compose 
<span class="nb">sudo chmod</span> +x /usr/local/bin/docker-compose

<span class="c"># ensure docker does not use iptabels</span>
<span class="nb">touch</span> /etc/docker/daemon.json
<span class="nb">tee</span> <span class="nt">-a</span> /etc/docker/daemon.json <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
{
  "iptables": false
}
</span><span class="no">EOF

</span><span class="c"># auto start docker on boot</span>
<span class="nb">echo</span> <span class="s2">"Starting docker service"</span> 
<span class="nb">echo</span> <span class="s2">"sudo service docker start"</span> <span class="o">&gt;&gt;</span> ~/.profile

<span class="c"># mount host drives to root /c/ etc.</span>
<span class="nb">touch</span> /etc/wsl.conf
<span class="nb">tee</span> <span class="nt">-a</span> /etc/wsl.conf <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
[automount]
root = /
options = "metadata"
</span><span class="no">EOF

</span><span class="c">#allow your account to sudo without password</span>
<span class="nb">sudo echo</span> <span class="s2">"</span><span class="nv">$USER</span><span class="s2"> ALL=(ALL) NOPASSWD:ALL"</span><span class="o">&gt;</span>/etc/sudoers
</code></pre></div></div>

<p>Reboot, open windows terminal and open bash prompt. You should be prompted for password to start docker. After that you can run <code class="language-plaintext highlighter-rouge">docker ps</code> to see if docker is running.</p>

<h3 id="thank-you">Thank you</h3>

<p>I hope you enjoyed this guide. If you have any questions or comments, feel free to contact me. I will be happy to help.</p>

<p>Let me know what you think and don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="docker-desktop" /><summary type="html"><![CDATA[You were great while you lasted!]]></summary></entry><entry><title type="html">How to add property and author a component programmatically?</title><link href="https://aem.design/blog/2022/01/19/how-to-add-property-and-author-a-component-programmatically" rel="alternate" type="text/html" title="How to add property and author a component programmatically?" /><published>2022-01-19T00:00:00+11:00</published><updated>2022-01-19T14:03:53+11:00</updated><id>https://aem.design/blog/2022/01/19/how-to-add-property-and-author-a-component-programmatically</id><content type="html" xml:base="https://aem.design/blog/2022/01/19/how-to-add-property-and-author-a-component-programmatically"><![CDATA[<h2 id="updatating-aem-content-programmatically">Updatating AEM Content programmatically?</h2>

<p>By far the easiest method of updating your AEM content programmatically is to use <a href="https://adobe-consulting-services.github.io/acs-aem-commons/features/on-deploy-scripts/index.html">ACS On-Deploy Script</a></p>

<p>To do this you will need these java files</p>
<ul>
  <li><a href="#1-ondeployscriptproviderimpljava">OnDeployScriptProviderImpl.java</a> - which will load your Script <code class="language-plaintext highlighter-rouge">UpdateNodeAttibutes</code>, read more about this in the docs.</li>
  <li><a href="#2-updatenodeattibutesjava">UpdateNodeAttibutes.java</a> - which will update your data..</li>
</ul>

<p>Here is starting content for your files‚Ä¶</p>

<h3 id="1-ondeployscriptproviderimpljava">1. OnDeployScriptProviderImpl.java</h3>

<p>Location: <code class="language-plaintext highlighter-rouge">design\aem\ondeploy\OnDeployScriptProviderImpl.java</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">design.aem.ondeploy</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.adobe.acs.commons.ondeploy.OnDeployScriptProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.adobe.acs.commons.ondeploy.scripts.OnDeployScript</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">design.aem.ondeploy.scripts.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Properties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Property</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.annotations.Component</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">immediate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Service</span>
<span class="nd">@Properties</span><span class="o">({</span>
        <span class="nd">@Property</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"service.description"</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"Developer service that identifies code scripts to execute upon deployment"</span><span class="o">)</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnDeployScriptProviderImpl</span> <span class="kd">implements</span> <span class="nc">OnDeployScriptProvider</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">OnDeployScript</span><span class="o">&gt;</span> <span class="nf">getScripts</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">UpdateNodeAttibutes</span><span class="o">()</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="2-updatenodeattibutesjava">2. UpdateNodeAttibutes.java</h3>

<p>Location: <code class="language-plaintext highlighter-rouge">design\aem\ondeploy\scripts\UpdateNodeAttibutes.java</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">design.aem.ondeploy.scripts</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.adobe.acs.commons.ondeploy.scripts.OnDeployScript</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.adobe.acs.commons.ondeploy.scripts.OnDeployScriptBase</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.search.PredicateGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.search.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.search.QueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.search.result.Hit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.search.result.SearchResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.day.cq.wcm.api.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.jcr.Node</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.jcr.RepositoryException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.jcr.Session</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sling.api.resource.ModifiableValueMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sling.api.resource.Resource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.sling.api.resource.ResourceResolver</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UpdateNodeAttibutes</span> <span class="kd">extends</span> <span class="nc">OnDeployScriptBase</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CONTENT_ROOT_PATH</span> <span class="o">=</span> <span class="s">"/content/"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">RENAME_ATTRIBUTES</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;()</span> <span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">ADD_ATTRIBUTES</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;()</span> <span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">QueryBuilder</span> <span class="n">queryBuilder</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getResourceResolver</span><span class="o">().</span><span class="na">adaptTo</span><span class="o">(</span><span class="nc">QueryBuilder</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// predicates for properties we are looking for.</span>
        <span class="c1">// more info on how to make these https://github.com/paulrohrbeck/aem-links/blob/master/querybuilder_cheatsheet.md</span>
        <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">param</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

        <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"path"</span><span class="o">,</span> <span class="no">CONTENT_ROOT_PATH</span><span class="o">);</span>
        <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"p.limit"</span><span class="o">,</span> <span class="s">"-1"</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="no">RENAME_ATTRIBUTES</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>

            <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"group."</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">"_property"</span><span class="o">,</span> <span class="s">"@"</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
            <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"group."</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">"_property.value"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
            <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"group."</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">"_property.operation"</span><span class="o">,</span> <span class="s">"exists"</span><span class="o">);</span>
            <span class="n">i</span><span class="o">++;</span>

        <span class="o">}</span>

        <span class="n">param</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"group.p.or"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>

        <span class="c1">// this will return a list of all pages that have any of properties we need</span>
        <span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">queryBuilder</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
                <span class="nc">PredicateGroup</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">param</span><span class="o">),</span>
                <span class="k">this</span><span class="o">.</span><span class="na">getResourceResolver</span><span class="o">().</span><span class="na">adaptTo</span><span class="o">(</span><span class="nc">Session</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">);</span>

        <span class="nc">SearchResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>

        <span class="kt">boolean</span> <span class="n">migrationError</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="c1">// walk the query result</span>
        <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">Hit</span> <span class="n">hit</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">getHits</span><span class="o">())</span> <span class="o">{</span>

            <span class="nc">Resource</span> <span class="n">resultResource</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="na">getResource</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">resultResource</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

                <span class="nc">ModifiableValueMap</span> <span class="n">resourceProps</span> <span class="o">=</span> <span class="n">resultResource</span><span class="o">.</span><span class="na">adaptTo</span><span class="o">(</span><span class="nc">ModifiableValueMap</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

                <span class="k">try</span> <span class="o">{</span>
                    <span class="c1">// walk though all nodes that need to be renamed</span>
                    <span class="k">for</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="no">RENAME_ATTRIBUTES</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
                        <span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
                        <span class="nc">String</span> <span class="n">newKey</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>

                        <span class="c1">// if node map contains attribute create a new entry.</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">resourceProps</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                            <span class="c1">// add value with new key</span>
                            <span class="n">resourceProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">newKey</span><span class="o">,</span><span class="n">resourceProps</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
                            <span class="c1">// remove old key and value</span>
                            <span class="n">resourceProps</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
                        <span class="o">}</span>
                    
                    <span class="o">}</span>
                    
                    <span class="k">for</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="no">ADD_ATTRIBUTES</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
                        <span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
                        <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>

                        <span class="c1">// if node map contains attribute create a new entry.</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">resourceProps</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                            <span class="c1">// add new key and value</span>
                            <span class="n">resourceProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span><span class="n">value</span><span class="o">);</span>
                        <span class="o">}</span>
                    
                    <span class="o">}</span>

                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">migrationError</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> 
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Could not complete migration."</span><span class="o">);</span>
                <span class="o">}</span>

                
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">migrationError</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">save</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Update <code class="language-plaintext highlighter-rouge">RENAME_ATTRIBUTES</code> and <code class="language-plaintext highlighter-rouge">ADD_ATTRIBUTES</code> maps for desired oucome, good luck and have fun!</p>

<h3 id="thank-you">Thank you</h3>

<p>If you would like to contribute or fork the code, you can get it on GitHub <a href="https://github.com/aem-design">https://github.com/aem-design</a> and through Maven central.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="aem" /><category term="ondeploy" /><category term="acs" /><category term="data" /><category term="patterns" /><summary type="html"><![CDATA[ACS On-Deploy is the answer!]]></summary></entry><entry><title type="html">SPA, Headless, Widgets and AEM?</title><link href="https://aem.design/blog/2021/09/10/spa-headless-widgets-and-aem" rel="alternate" type="text/html" title="SPA, Headless, Widgets and AEM?" /><published>2021-09-10T00:00:00+10:00</published><updated>2021-09-10T17:35:40+10:00</updated><id>https://aem.design/blog/2021/09/10/spa-widgets-and-aem</id><content type="html" xml:base="https://aem.design/blog/2021/09/10/spa-headless-widgets-and-aem"><![CDATA[<p>There are many ways to build the web; most of the ways can be implemented in AEM, which one works best is going to depend on your authors. What the authors are willing to author, how involved do they get with content, and how involved do they want to get with crafting experiences? Once you answer, these questions the solution will pop out. The following should provide an overview of available options and arm you with information to make a choice.</p>

<h2 id="spa-headless-add-widgets-patterns-in-aem">SPA, Headless add Widgets patterns in AEM</h2>

<p>Before we starte here is a context of each term</p>

<p>SPA - single page application an alternative to a multi-page website.
SPA Editor - AEM native editor for SPA‚Äôs
Headless - a pattern where you leverage API or GrapgQL to get data from server
Widget - a component of a web page with clientside experience, it has basic HTML, and javascript turns into the interactive experience when loaded.</p>

<p>Now we can extrapolate these in relation to AEM. Here is a summary of patterns of implementing single-page and multi-page experience in AEM. In a lot of AEM implementations, you will find that all of these methods would have been utilised over time.</p>

<p>SPA - is a standalone application hosted externally to AEM, managed by developers, potential config by authors through content; can be headless.
SPA in a Page - provides a method of host SPA application in a page, giving the ability to place SPA‚Äôs in different parts of the site; developer-focused, SPA has a dedicated component with possible authoring inputs; can be headless.
SPA Editor - native ability to create SPA‚Äôs in AEM, allow full authoring of application; native components; can be headless.
Page - a native way to create multi-page experiences, allow full authoring of pages, full content reuse and ability to use any components needed; a primary way of creating content for the web.
Widgets in Page - small targeted components that are added to pages to create experiences; provides a way to create rich experiences that could be hard to author; can be headless.</p>

<p>Here is this information in a table.</p>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">Hosting</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">Page Experience</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">Focus</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">Content Usage</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">¬†</th>
      <th style="text-align: center">¬†</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Pattern</td>
      <td style="text-align: center">Headless</td>
      <td style="text-align: center">External</td>
      <td style="text-align: center">Internal</td>
      <td style="text-align: center">Single Page</td>
      <td style="text-align: center">Multi-Page</td>
      <td style="text-align: center">Authoring</td>
      <td style="text-align: center">Developer</td>
      <td style="text-align: center">API</td>
      <td style="text-align: center">Page</td>
      <td style="text-align: center">Tags</td>
      <td style="text-align: center">Assets</td>
    </tr>
    <tr>
      <td>SPA</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
    </tr>
    <tr>
      <td>SPA in Page</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
    </tr>
    <tr>
      <td>SPA Editor</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
    </tr>
    <tr>
      <td>Page</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
    </tr>
    <tr>
      <td>Widget in Page</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">¬†</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
      <td style="text-align: center">x</td>
    </tr>
  </tbody>
</table>

<p>Adding a Design Language System into the mix would also add another level of complexity as SPA, and native Web will have different Design Language primarily because native AEM components can have Styles applied to them by authors, and SPA would have a more focused and controlled set of settings.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Focussing on AEM Authoring experience will always be beneficial as it will allow more people to help to grow experience. Having more eyes and hands helping to build the experience is always a good thing.</p>

<p>If you are must have a developer-centric experience and use AEM as a content repository, you can do it but you will be missing out on a lot of benefits that you would need to invent from sratch.</p>

<p>Using AEM SPA Editor will allow opening your experience building to authors so that they can help in any way they can. If you just have developers doing the authoring, then you will also missout on valuable input, and chances are you will rever to the vanila SPA pattern.</p>

<p>Going down the Widgets in a Page will give you the biggest impact as you can leverage all of the content authoring patterns and content services available in AEM. This will allow you to integrate widgets into existing pages, allow you to target them easily and importantly, all of this will be done by authors.</p>

<p>Obviously, all other patterns can be developed to the same level of maturity given appropriate time and effort.</p>

<h2 id="background">Background</h2>

<p>Here is the background information on building blocks that are used in SPA patterns.</p>

<h3 id="web-experiences">Web Experiences</h3>

<p>There are many ways to make great experiences for the web. In the end HTML and CSS is what all experiences are made of and its the details of how the developers choose to implement those experiences that varries. Traditional methods of we dev are either plain HTML pages or Single Page Application‚Äôs (SPA‚Äôs).</p>

<p>Plain HTML approach means that you develop multi-page experiences where a user is navigating a network of related pages. It‚Äôs a long term play, and you leverage a lot of technical and taxonomy tools to help you to play this out over a long period of time.</p>

<p><img src="/assets/diagrams/01-aem-spa-plain-web.png" alt="Plain Web" /></p>

<p>Single Page Applications or SPA‚Äôs is another approach that focuses all of the experiences into one page. This means that user does not navigate pages as such, they are confined to one page, and they navigate experience as its laid-out by the SPA, SPA uses traditional API‚Äôs or GraphQL to gather content it needs.</p>

<p><img src="/assets/diagrams/03-aem-spa-api-client-side.png" alt="SPA API" /></p>

<h3 id="aem-native-apis">AEM native API‚Äôs</h3>

<p>AEM technical strength is in the flexibility of content, content architecture and ability to render content in place in different ways. You can store content in AEM in anyway you want, structure it to make logical sense and retrieve it either with native API, GraphQL or custom API you need.</p>

<p>In AEM, you can store some content into a location <code class="language-plaintext highlighter-rouge">/content/page</code> then request its HTML representation <code class="language-plaintext highlighter-rouge">/content/page.html</code>, then request its XML representation <code class="language-plaintext highlighter-rouge">/content/page.xml</code>, then request its JSON representation <code class="language-plaintext highlighter-rouge">/content/page.tidy.5.json</code>, then request its Image representation <code class="language-plaintext highlighter-rouge">/content/page.thumbnail.png</code> and on and on.</p>

<p>AEM has a method for adding these renderers (html, json, xml, thubnail.png) that enable you to read content from anywhere and how you want it, essentially allowing the whole content repository to act as an API source, and you can read different bits of different content is many ways depending on your need.</p>

<p>AEM has a number of content experiences Content Fragments and Models, Experience Fragments, Tags and Sling API that allow you to get content from AEM. Additionally, ACS has several services that further complement OOTB functionality.</p>

<h3 id="aggregation-api">Aggregation API</h3>

<p>When it comes to the traditional API approach, the aim it funnels all of the calls into one area, one ‚Äúservice‚Äù that handles a request for that content. You typically should have an API gateway to ensure you do not flood your backend service and you would have a number API returning either atomic data or aggregated set of data.</p>

<p><img src="/assets/diagrams/04-aem-spa-api-client-side-aggregation.png" alt="Aggregation Headless Client Side" /></p>

<p>Aggregation of API‚Äôs is a pattern for gathering data from different API‚Äôs and presenting it in one package to the consumer. This pattern can be implemented both on the client and server-side. GraphQL essentially provides a server-side and client-side aggregation in one; you can get atomic data and aggregate as well with one API.</p>

<p><img src="/assets/diagrams/05-aem-spa-api-server-side-aggregation.png" alt="Aggregation Headless Server Side" /></p>

<p>GraphQL API approach allows you to get the same data as traditional API but potentially at the client-side. This obviously has a lot of perceived flexibility as the structure of API is moved up the stack and managed by the UI layer, and the same methods should be used to protect the backend.</p>

<h3 id="headless-aem">Headless AEM</h3>

<p>Headless is a method of using AEM as a source of data, and the primary way of achieving this is by using API and GraphQL for getting data out of AEM. This pattern can be used in any SPA and Widget approach but does make AEM more developer-focused.</p>

<p><img src="/assets/diagrams/06-aem-spa-headless.png" alt="Headless" /></p>

<h4 id="widgets-in-aem">Widgets in AEM</h4>

<p>Widgets are a way of creating AEM authoring components that have rich client-side presentations. This pattern allows full authoring experiences and all of the API patterns to be used.</p>

<p><img src="/assets/diagrams/02-aem-spa-api-widgets.png" alt="Widgets" /></p>

<h3 id="thank-you">Thank you</h3>

<p>Please checkout the docker hub <a href="https://hub.docker.com/r/aemdesign/aem">aemdesign/aem</a> for latest AEM SDK images.</p>

<p>If you would like to contribute or fork the code, you can get it on GitHub <a href="https://github.com/aem-design">https://github.com/aem-design</a> and through Maven central.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="aem" /><category term="spa" /><category term="headless" /><category term="widgets" /><category term="knowledge" /><category term="patterns" /><summary type="html"><![CDATA[When to use these and what they achieve?]]></summary></entry><entry><title type="html">AEM Akamai Cache flush Agent üòç</title><link href="https://aem.design/blog/2021/04/25/creating-akamai-flush-agent" rel="alternate" type="text/html" title="AEM Akamai Cache flush Agent üòç" /><published>2021-04-25T00:00:00+10:00</published><updated>2021-09-21T16:35:10+10:00</updated><id>https://aem.design/blog/2021/04/25/creating-akamai-flush-agent</id><content type="html" xml:base="https://aem.design/blog/2021/04/25/creating-akamai-flush-agent"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>After the first hit to the page in aem and HTML response received for first time from publish instance will get cached on Akamai level.</p>

<p>Subsequent request to the same page will be served from the cached content in Akamai rather than hitting dispatcher / publisher.</p>

<p>Anytime did you struggled to get the latest HTML from publisher instead of Akamai cache?</p>

<p><strong><em>Well we did!!!</em></strong></p>

<h2 id="what-we-have-done">What we have done</h2>

<p>We have worked on AEM replication agent for flushing Akamai cache whenever page gets published.</p>

<p>So, after author change a page content and publish it our Akamai cache flush agent configured on publisher environment will pick that page and request to akamai for clearing cache. 
So that user of that page will get the latest content instead of cached old content from Akamai.</p>

<p>It is all automated, we don‚Äôt need to clear the Akamai cache when new product goes live to prod.</p>

<p>We don‚Äôt ask DevOps to clear Akamai cache so customers will see latest page. Lets save their 1-2 min(s) time whenever new product launch.</p>

<h2 id="where-you-can-find-the-code">Where you can find the code</h2>

<p><a href="https://github.com/aem-design/aemdesign-aem-core/tree/master/aemdesign-aem-common/src/main/content/jcr_root/apps/aemdesign/components/replication/akamai">Akamai Cache Flush Agent</a></p>

<p><a href="https://github.com/aem-design/aemdesign-aem-core/blob/master/aemdesign-aem-services/src/main/java/design/aem/transport/AkamaiTransportHandler.java">Akamai Transport Handler</a></p>

<h2 id="what-are-all-details-do-you-need-to-setup-flush-agent">What are all details do you need to setup flush agent</h2>

<ol>
  <li>akamaiDomain</li>
  <li>akamaiBaseUrl</li>
  <li>akamaiPurgeUrlPath</li>
  <li>clientToken</li>
  <li>clientAccessToken</li>
  <li>clientSecret</li>
</ol>

<p>If you think you don‚Äôt know these info‚Äôs or not sure from where you can get it? Ask devOps these information and say I got your back if you provide me these info üòç</p>

<h2 id="how-we-are-managing-the-secrets">How we are managing the secrets</h2>

<p>After getting the above information from you, we are encrypting keys using AEM‚Äôs crypto support and storing it on AEM so you are safe with your secrets.
While we use it for making the POST call from Transport Handler we will decrypt the keys and use it.</p>

<p>Also while making a POST call to Akamai servers we are using HMAC_SHA_256 to protect the data.</p>

<p>Make sure you are configuring the Akamai cache flush agent on each environment separately</p>

<h2 id="how-to-configure-akamai-flush-agent-on-your-aem-author--publish-instance">How to configure Akamai flush agent on your AEM author / publish instance</h2>

<p>By Assuming you have installed aem design code into your local AEM.</p>

<h2 id="when-to-setup-on-author-and-when-to-setup-on-publish">When to setup on author and when to setup on publish</h2>

<p>Setup Akamai flush agent on AEM author instance only if you have akamai setup on author level as well. Mostly we will have Akamai setup for publish env.</p>

<p>Always setup Akamai flush agent on publish level so as soon as the page reaches publish instance our Akamai flush agent will go ahead and clear Akamai Cache.</p>

<h2 id="how-to-setup-akamai-flush-agent">How to setup Akamai flush agent</h2>

<p>Go to <a href="http://localhost:4502/miscadmin">miscadmin</a> and open replication/agents.author for author instance &amp; replication/agents.publish for publish instance</p>

<p>here I‚Äôm showing example of setting flush agent in author level same time you can set it in publisher as well.</p>

<p><img src="/assets/images/akamai-flush-agent/akamai-replication-miscadmin.png" alt="miscadmin" /></p>

<p>Click new from tool bar and you will see the Create Page dialog.</p>

<p><img src="/assets/images/akamai-flush-agent/akamai-create-agent.png" alt="create new agent" /></p>

<p>Select ‚ÄúAkamai Publishing Replication‚Äù and give your replication agent a name &amp; title.
Click on create and open the newly created agent on the list. (it will be the last entry on the list)
Click on Edit and provide the information required and click on Ok.</p>

<p><img src="/assets/images/akamai-flush-agent/akamai-settings-tab.png" alt="settings tab" /></p>

<p><img src="/assets/images/akamai-flush-agent/akamai-config-tab.png" alt="config_tab" /></p>

<p>You should be able to see the Akamai Flush Agent is On (green) and it will look for any replication events.</p>

<p><img src="/assets/images/akamai-flush-agent/akamai-enabled-agent.png" alt="success" /></p>

<p>Click on Test Connection link and make sure you have all the correct configurations.
You should see ‚ÄúReplication test succeeded‚Äù</p>

<h2 id="conclusion">Conclusion</h2>

<p>This component will save our time whenever we need to update the content in AEM pages.</p>

<p>Make sure you have set up the dispatcher flush agent as well so we can avoid content served from Dispatcher cache.</p>

<p>Feel free to reach out to us if you have any questions and don‚Äôt forget to tell your friends.</p>

<h3 id="thank-you">Thank you</h3>]]></content><author><name>Seenivasa Ragavan Soundar Rajan</name><email>mailtoragavan.be@gmail.com</email></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="akamai" /><category term="knowledge" /><category term="sharing" /><summary type="html"><![CDATA[Why should we bother DevOps to clear Akamai Cache when you can do it yourself using flush agent]]></summary></entry><entry><title type="html">AEM SDK and JDK11</title><link href="https://aem.design/blog/2021/03/16/aem-sdk-jdk11" rel="alternate" type="text/html" title="AEM SDK and JDK11" /><published>2021-03-16T23:37:00+11:00</published><updated>2021-12-22T10:23:36+11:00</updated><id>https://aem.design/blog/2021/03/16/aem-sdk-jdk11</id><content type="html" xml:base="https://aem.design/blog/2021/03/16/aem-sdk-jdk11"><![CDATA[<p>Building on the previous work <a href="/blog/2019/07/01/docker-containers-everywhere">Docker Containers Everywhere</a>, <a href="/blog/2019/09/04/aem-and-dockerüòçüòò">AEM and Docker üòçüòò</a> and <a href="/blog/2019/08/30/docker-aem-bundle">Docker AEM Bundle</a> its time to bring AEM SDK and JDK11 into life!</p>

<p>If you take a look <a href="https://hub.docker.com/r/aemdesign/aem">docker hub</a> and <a href="https://github.com/aem-design/docker-aem">docker-aem</a> branches you will find a couple of new additions that you will find helpful.</p>

<p>JDK11 version of AEM 6.5 and AEM SDK version is now ready for use!</p>

<h3 id="running-aem-jdk-11-in-docker">Running AEM JDK 11 in Docker</h3>

<p>To start author AEM 6.5 with SP10 on JDK11 run the following:</p>

<div class="code-copy-header">
  <button class="copy-code-button" aria-label="Copy code to clipboard"></button>
</div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">author655</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"TZ=Australia/Sydney"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_RUNMODE=-Dsling.run.modes=author,crx3,crx3tar,forms,localdev"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_JVM_OPTS=-server -Xms248m -Xmx1524m -XX:MaxDirectMemorySize=256M -XX:+CMSClassUnloadingEnabled -Djava.awt.headless=true -Dorg.apache.felix.http.host=0.0.0.0 -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=58242,suspend=n -XX:+UseParallelGC --add-opens=java.desktop/com.sun.imageio.plugins.jpeg=ALL-UNNAMED --add-opens=java.base/sun.net.www.protocol.jrt=ALL-UNNAMED --add-opens=java.naming/javax.naming.spi=ALL-UNNAMED --add-opens=java.xml/com.sun.org.apache.xerces.internal.dom=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/jdk.internal.loader=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED -Dnashorn.args=--no-deprecation-warning"</span><span class="w"> </span><span class="nt">-p4502</span><span class="p">:</span><span class="nx">8080</span><span class="w"> </span><span class="nt">-p30303</span><span class="p">:</span><span class="nx">58242</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">aemdesign/aem:6.5.10.0-jdk11</span><span class="w">
</span></code></pre></div></div>

<p>To start author AEM SDK version 2021.10.5958 run the following:</p>

<div class="code-copy-header">
  <button class="copy-code-button" aria-label="Copy code to clipboard"></button>
</div>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">authorsdk2021105958</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"TZ=Australia/Sydney"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_RUNMODE=-Dsling.run.modes=author,crx3,crx3tar,forms,localdev"</span><span class="w"> </span><span class="nt">-e</span><span class="w"> </span><span class="s2">"AEM_JVM_OPTS=-server -Xms248m -Xmx1524m -XX:MaxDirectMemorySize=256M -XX:+CMSClassUnloadingEnabled -Djava.awt.headless=true -Dorg.apache.felix.http.host=0.0.0.0 -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=58242,suspend=n -XX:+UseParallelGC --add-opens=java.desktop/com.sun.imageio.plugins.jpeg=ALL-UNNAMED --add-opens=java.base/sun.net.www.protocol.jrt=ALL-UNNAMED --add-opens=java.naming/javax.naming.spi=ALL-UNNAMED --add-opens=java.xml/com.sun.org.apache.xerces.internal.dom=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/jdk.internal.loader=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED -Dnashorn.args=--no-deprecation-warning"</span><span class="w"> </span><span class="nt">-p4502</span><span class="p">:</span><span class="nx">8080</span><span class="w"> </span><span class="nt">-p30303</span><span class="p">:</span><span class="nx">58242</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">aemdesign/aem:sdk-2021.10.5958</span><span class="w">
</span></code></pre></div></div>

<p>To make all this possible following Docker image chain has been updated:</p>

<ul>
  <li><a href="https://github.com/aem-design/docker-aem/tree/jdk11">aemdesign/aem:jdk11</a> - AEM Quickstart content
    <ul>
      <li><a href="https://github.com/aem-design/docker-aem-base/tree/jdk11">aemdesign/aem-base:jdk11</a> - AEM linux dependencies
        <ul>
          <li><a href="https://github.com/aem-design/docker-java-ffmpeg/tree/jdk11">aemdesign/java-ffmpeg:jdk11</a> - provides ImageMagic and FFMpeg libraries
            <ul>
              <li><a href="https://github.com/aem-design/docker-oracle-jdk/tree/jdk11">aemdesign/oracle-jdk:jdk11</a> - provides a an oracle jdk
                <ul>
                  <li><a href="https://github.com/aem-design/docker-centos-tini/tree/centos8">aemdesign/centos-tini:centos8</a> - provides a base for all java apps</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>In addition to these pipelines have been updated to allow Docker Image squash experimental option to ensure all images have the smallest amount of layers.</p>

<p>Additionally, centos build pack has been updated to JDK 11 and Centos 8 with all the swiss army knife tools one expects.</p>

<ul>
  <li><a href="https://github.com/aem-design/docker-centos-java-buildpack/tree/jdk11">aemdesign/centos-java-buildpack:jdk11</a></li>
</ul>

<h3 id="thank-you">Thank you</h3>

<p>Please checkout the docker hub <a href="https://hub.docker.com/r/aemdesign/aem">aemdesign/aem</a> for further details.</p>

<p>If you would like to contribute or fork the code, you can get it on GitHub <a href="https://github.com/aem-design">https://github.com/aem-design</a>.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="docker" /><summary type="html"><![CDATA[Building on the previous work Docker Containers Everywhere, AEM and Docker üòçüòò and Docker AEM Bundle its time to bring AEM SDK and JDK11 into life!]]></summary></entry><entry><title type="html">Automation Testing For AEM Dialogs</title><link href="https://aem.design/blog/2021/01/21/automation-testing-for-aem-dialogs" rel="alternate" type="text/html" title="Automation Testing For AEM Dialogs" /><published>2021-01-21T00:37:00+11:00</published><updated>2021-04-27T02:36:37+10:00</updated><id>https://aem.design/blog/2021/01/21/automation-testing-for-aem-dialogs</id><content type="html" xml:base="https://aem.design/blog/2021/01/21/automation-testing-for-aem-dialogs"><![CDATA[<p>Automation testing is an absolute mandatory and covered in <a href="/blog/2017/06/28/automation-testing">Automation Testing and Human Reporting</a> and demonstrates a viable, usable AEM Automated Testing approach and does not make the automated testing suite a development only agenda.</p>

<p>Over the last few years, AEM Automation Testing for AEM Dialog has been getting more focus, and I have been asked by many how to do this easily. The current approach leverages existing AEM Editor experience to view and load dialogs so that they can be tested. One of the improvements that have been asked can that be made faster so that actual pages do not require loading, so that spec execution speed improves.</p>

<p>AEM being a gem of capabilities has this covered, and with little effort, we can leverage this to really create powerful specs that test component dialogues as a user would use them. The key to this is understanding how AEM loads component dialogs and the data they represent. Fortunately this pattern very simple using sling.</p>

<ul>
  <li>First you need a path to a dialog (<code class="language-plaintext highlighter-rouge">/apps/aemdesign/components/details/generic-details/v1/generic-details/_cq_dialog.html</code>) this path is a component that takes as a parameter as a path to the component dialog should show and update.</li>
  <li>Second you need a content path (<code class="language-plaintext highlighter-rouge">/content/aemdesign-showcase/au/en/component/details/generic-details/jcr:content/article/par/contentblock7/par/genericdetails</code>) which dialog should update. This is simply any path that dialog will use for reading and wirting.</li>
  <li>Third you combine these into a url you can use for automation <code class="language-plaintext highlighter-rouge">http://localhost:4512/mnt/override/apps/aemdesign/components/details/generic-details/v1/generic-details/_cq_dialog.html/content/aemdesign-showcase/au/en/component/details/generic-details/jcr:content/article/par/contentblock7/par/genericdetails</code></li>
</ul>

<p>And that‚Äôs it! Now you can write any tests around this URL. Taking this knowledge a spec can be updated to allow testing AEM Dialog with ease and without loading whole pages!</p>

<p>Here is a reference AEM component dialog spec that tests of the tabs that appear on the component have the right content appearing. This is done simply by taking a screenshot of the dialog‚Äôs page.</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">specs.component.details.genericdetails</span>

<span class="kn">import</span> <span class="nn">spock.lang.Stepwise</span>
<span class="kn">import</span> <span class="nn">support.AuthorDialogSpec</span>

<span class="nd">@Stepwise</span>
<span class="kd">class</span> <span class="nc">GenericDetailsAuthorDialogSpec</span> <span class="kd">extends</span> <span class="n">AuthorDialogSpec</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">pathPage</span> <span class="o">=</span> <span class="s2">"components/details"</span>
    <span class="n">String</span> <span class="n">pathSite</span> <span class="o">=</span> <span class="s2">"mnt/override/apps/aemdesign"</span>
    <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">String</span> <span class="n">componentPath</span> <span class="o">=</span> <span class="s2">"generic-details/v1/generic-details/_cq_dialog"</span>
    <span class="n">String</span> <span class="n">pageExtensionSuffix</span> <span class="o">=</span> <span class="s2">"/content/aemdesign-showcase/au/en/component/details/generic-details/jcr:content/article/par/contentblock7/par/genericdetails"</span>

    <span class="kt">def</span> <span class="nf">setupSpec</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">loginAsAdmin</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">cleanupSpec</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">analyzeLog</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="s2">"Dialog of Component with Content"</span><span class="o">()</span> <span class="o">{</span>

        <span class="nl">given:</span> <span class="s2">"Component dialog exist"</span>
        <span class="kt">def</span> <span class="n">selector</span> <span class="o">=</span> <span class="s2">"coral-dialog"</span>

        <span class="nl">when:</span> <span class="s2">"I open dialog with content"</span>
        <span class="n">go</span> <span class="s2">"/${pathSite}/${pathPage}/${componentPath}${pageExtension}${pageExtensionSuffix}"</span>

        <span class="nl">then:</span> <span class="s2">"The component dialog should render"</span>
        <span class="n">waitFor</span> <span class="o">{</span> <span class="n">$</span><span class="o">(</span><span class="n">selector</span><span class="o">)</span> <span class="o">}</span>

        <span class="nl">and:</span> <span class="s2">"Dialog should be able to open"</span>
        <span class="n">showDialogDirect</span><span class="o">()</span>
        <span class="n">report</span><span class="o">(</span><span class="s2">"Dialog should be able to open"</span><span class="o">)</span>

        <span class="nl">when:</span> <span class="s2">"When I select Layout tab"</span>
        <span class="n">selectDialogTab</span><span class="o">(</span><span class="s2">"Layout"</span><span class="o">)</span>
        <span class="n">waitFor</span> <span class="o">{</span> <span class="n">tabSelected</span><span class="o">(</span><span class="s2">"Layout"</span><span class="o">)</span> <span class="o">}</span>
        <span class="n">report</span><span class="o">(</span><span class="s2">"Layout tab selected"</span><span class="o">)</span>

        <span class="nl">then:</span> <span class="s2">"Then it should have the Custom Layout options selected and matching configuration options"</span>
        <span class="n">designRefFull</span><span class="o">(</span><span class="n">selector</span><span class="o">,</span> <span class="s2">"tab-layout"</span><span class="o">)</span>

        <span class="nl">where:</span>
        <span class="n">viewport</span> <span class="o">&lt;&lt;</span> <span class="n">getDialogViewPort</span><span class="o">()</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Once you run this spec you will get an excellent report that will help you determine if the dialog works as you expected it.</p>

<p><img src="/assets/images/automation-testing/dialog-test/generic-details-author-dialog.png" alt="Automation Testing Report - Generic Details" /></p>

<p>As you can see this pattern will allow you to test AEM Dialogs especially if you are into making customised controls, if you are stuck, look at some examples in <a href="https://github.com/aem-design/aemdesign-aem-support/blob/clean-up-compose-project/aemdesign-testing/src/test/groovy/specs/component/details/genericdetails/GenericDetailsAuthorDialogSpec.groovy">GenericDetailsAuthorDialogSpec.groovy</a>.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="testing" /><category term="automation-testing" /><summary type="html"><![CDATA[Automation testing is an absolute mandatory and covered in Automation Testing and Human Reporting and demonstrates a viable, usable AEM Automated Testing approach and does not make the automated testing suite a development only agenda.]]></summary></entry><entry><title type="html">Creating Custom Workflow Step</title><link href="https://aem.design/blog/2021/01/18/creating-custom-workflow-step" rel="alternate" type="text/html" title="Creating Custom Workflow Step" /><published>2021-01-18T00:37:00+11:00</published><updated>2021-03-14T01:50:42+11:00</updated><id>https://aem.design/blog/2021/01/18/creating-custom-workflow-step</id><content type="html" xml:base="https://aem.design/blog/2021/01/18/creating-custom-workflow-step"><![CDATA[<p>When writing custom workflow services, you may find yourself not seeing your service being recognised by the Process Step.
You will first encounter this when you don‚Äôt see your service appear in the process list on the dialog.
And once you verify the data source that feeds that dropdown at <a href="http://localhost:4502/libs/cq/workflow/content/console/process.json">http://localhost:4502/libs/cq/workflow/content/console/process.json</a> you will wonder why.
You may also see errors like this <code class="language-plaintext highlighter-rouge">Could not find service for service reference {YOUR WORKFLOW STEP CLASS PATH} with label {no label}</code> that could just tell you your class is missing property <code class="language-plaintext highlighter-rouge">process.label</code>.</p>

<p>Now that you know, you add this property to your class and your class appear in the list, here is an example of how to add it:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span><span class="o">(</span>
    <span class="n">immediate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
    <span class="n">service</span> <span class="o">=</span> <span class="nc">WorkflowProcess</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="n">property</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"process.label=Content Fragment Page Generator"</span> <span class="o">}</span>
    <span class="o">)</span>
</code></pre></div></div>

<p>Also while debugging this, you may find some other errors polluting your docker logs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The activate method has thrown an exception (java.lang.IllegalStateException: org.apache.sling.api.resource.LoginException: Cannot derive user name for bundle com.adobe.acs.acs-aem-commons-bundle [553] and sub service workflowpackagemanager-service
</code></pre></div></div>

<p>To fix this, all you need to do is add missing service mapping mentioned in the message.
You should be able to replicate this by restarting your missing component at eg <a href="http://localhost:4502/system/console/components/design.aem.workflow.process.ContentFragmentPageGenerator">http://localhost:4502/system/console/components/design.aem.workflow.process.ContentFragmentPageGenerator</a>.
In example above missing use name is <code class="language-plaintext highlighter-rouge">workflowpackagemanager-service</code> and bundle is <code class="language-plaintext highlighter-rouge">com.adobe.acs.acs-aem-commons-bundle</code>.
To add this missing entry do this:</p>

<ul>
  <li>open <a href="http://localhost:4502/system/console/configMgr/">http://localhost:4502/system/console/configMgr/</a></li>
  <li>search for <code class="language-plaintext highlighter-rouge">com.adobe.acs.acs-aem-commons-bundle</code> look for mapping in <code class="language-plaintext highlighter-rouge">Apache Sling Service User Mapper Service Amendment</code></li>
  <li>add or update blank entry with <code class="language-plaintext highlighter-rouge">com.adobe.acs.acs-aem-commons-bundle:workflowpackagemanager-service=workflow-process-service</code></li>
</ul>

<p>Hopefully, after this, your custom workflow step will work, if you are stuck, look at some examples in <a href="https://github.com/aem-design/aemdesign-aem-core/tree/develop/aemdesign-aem-services/src/main/java/design/aem/workflow/process">aemdesign-aem-services/../workflow/process</a>.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="structure" /><category term="bugs-maybe" /><summary type="html"><![CDATA[When writing custom workflow services, you may find yourself not seeing your service being recognised by the Process Step. You will first encounter this when you don‚Äôt see your service appear in the process list on the dialog. And once you verify the data source that feeds that dropdown at http://localhost:4502/libs/cq/workflow/content/console/process.json you will wonder why. You may also see errors like this Could not find service for service reference {YOUR WORKFLOW STEP CLASS PATH} with label {no label} that could just tell you your class is missing property process.label.]]></summary></entry><entry><title type="html">Using Docker to Build Code</title><link href="https://aem.design/blog/2020/07/24/using-docker-to-build-code" rel="alternate" type="text/html" title="Using Docker to Build Code" /><published>2020-07-24T23:37:00+10:00</published><updated>2021-03-14T01:50:42+11:00</updated><id>https://aem.design/blog/2020/07/24/using-docker-to-build-code</id><content type="html" xml:base="https://aem.design/blog/2020/07/24/using-docker-to-build-code"><![CDATA[<p>When you have been working for a long time on a codebase, you don‚Äôt tend to test if your code can be compiled on other machines. Most of the time, it means that it won‚Äôt. But when you have Docker on your side, your dispair would be a one short docker command line deep.</p>

<p>Using Docker to build your code is so easy even your friend will think you are cool when you tell them about it.  The most amazing thing that you don‚Äôt even need to write any Docker images, there are so many ready-to-go buildpack containers out there you can easily pick up something that you need.</p>

<p>Here is an example of a container we use to do pipeline build and its very suitable for compiling your project on your local desktop. This container is a Centos 7 Jave Build Pack which means that it comes preconfigured with a majority of tools that are needed to compile our projects.</p>

<p>This container comes with Jave, NPM and RVM, and you can take a look at the contents of the <a href="https://github.com/aem-design/docker-centos-java-buildpack/blob/master/Dockerfile">dockerfile</a>.</p>

<p>In power Shell:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-it</span><span class="w"> </span><span class="nt">-v</span><span class="w"> </span><span class="nv">${PWD}</span><span class="p">:</span><span class="nx">/build/source</span><span class="w"> </span><span class="nt">-v</span><span class="w"> </span><span class="nv">${HOME}</span><span class="nx">/.m2:/build/.m2</span><span class="w"> </span><span class="nt">--net</span><span class="o">=</span><span class="n">host</span><span class="w"> </span><span class="nx">aemdesign/centos-java-buildpack</span><span class="w"> </span><span class="nx">/bin/bash</span><span class="w"> </span><span class="nt">--login</span><span class="w">
</span></code></pre></div></div>

<p>In Bash:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-v</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:/build/source <span class="nt">-v</span> <span class="k">${</span><span class="nv">HOME</span><span class="k">}</span>/.m2:/build/.m2 <span class="nt">--net</span><span class="o">=</span>host aemdesign/centos-java-buildpack /bin/bash <span class="nt">--login</span>
</code></pre></div></div>

<p>Let‚Äôs break this command down.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-it</code> means run interactive terminal</li>
  <li><code class="language-plaintext highlighter-rouge">-v ${PWD}:/build/source</code> map current path into container at path <code class="language-plaintext highlighter-rouge">/build/source</code>
    <ul>
      <li>in Powershell ${PWD} is same as <code class="language-plaintext highlighter-rouge">pwd</code> in bash</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">-v ${HOME}/.m2:/build/.m2</code> map your Maven cache folder into the container to reuse your already downloaded jars</li>
  <li><code class="language-plaintext highlighter-rouge">--net=host</code> allow container to access your desktop localhost</li>
  <li><code class="language-plaintext highlighter-rouge">amdesign/centos-java-buildpack</code> image to use</li>
  <li><code class="language-plaintext highlighter-rouge">/bin/bash --login</code> run bash and perform login to ensure all of the start-up profile scripts are executed</li>
</ul>

<p>All you need to do now is to run this command in the directory where you have your code and start compiling like a boss.</p>

<p>Don‚Äôt forget to tell your friends.</p>]]></content><author><name>Max Barrass</name><email>max@aem.design</email><uri>http://maxbarrass.com</uri></author><category term="blog" /><category term="devops" /><category term="aem" /><category term="docker" /><summary type="html"><![CDATA[When you have been working for a long time on a codebase, you don‚Äôt tend to test if your code can be compiled on other machines. Most of the time, it means that it won‚Äôt. But when you have Docker on your side, your dispair would be a one short docker command line deep.]]></summary></entry></feed>